begin

паттерны
* outbox table - сохранение аггрегата и исходящего события в одной транзакции
* коммутативность

сложные случаи  
* обеспечение коммутативности если pay_request_event придет раньше чем booked_event
, в таком случае booked event отбрасывается
* с кнопки оплата уйдет два запроса на создание и оплату заказа - 
  сделать блокировку на zookeeper(если несколько сервисов order-service) по customer_id 
  и не давать создавать больше одного неоплаченного заказа  
* дедубликация сообщений - хранить uid входящих сообщений, проверять и отбрасывать если уже было  
* покупатель оплатил не всю сумму -  
* платеж не прошел - нужно откатить сагу - разбронировать продукты


? Надо ли рисовать блок outbox table
